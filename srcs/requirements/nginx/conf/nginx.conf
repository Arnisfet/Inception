events {}

http
{
server {
# Listen to the https port in IPv4 and IPv6
	listen 443 ssl;
	listen [::]:443 ssl;
# Server name	
	server_name mrudge.42.fr;
# Use the ssl sertificate
	ssl_certificate_key /etc/ssl/private/nginx.key;
	ssl_certificate /etc/ssl/certs/nginx.crt;
	ssl_protocols TLSv1.3;

	index index.php index.html index.htm;
    	root /var/www/html/wordpress;
    	
    	 location / {
        try_files $uri $uri/ /index.php$is_args$args;
    }
	# этот блок расположения будет обрабатывать PHP-запросы и проксировать эти запросы в наш контейнер wordpress. 
	# Поскольку наш образ WordPress Docker будет опираться на образ php:fpm, 
	# мы также добавим параметры конфигурации, принадлежащие протоколу FastCGI, в этот блок. 
	# Nginx требует наличия независимого процессора PHP для запросов PHP: 
	# в нашем случае эти запросы будут обрабатываться процессором php-fpm, который будет включать образ php:fpm. 
	# Кроме того, этот блок расположения содержит директивы FastCGI, переменные и опции, 
	# которые будут проксировать запросы для приложения WordPress, запущенного в нашем контейнере wordpress, 
	# задавать предпочитаемый индекс захваченного URI запроса, а также выполнять парсинг URI-запросов
    location ~ [^/]\.php(/|$) { 
            try_files $uri =404;
            fastcgi_split_path_info ^(.+\.php)(/.+)$;
            fastcgi_pass wordpress:9000;
            fastcgi_index index.php;
            include fastcgi_params;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            fastcgi_param PATH_INFO $fastcgi_path_info;
        }
    }
}
